<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Solvoro â€” Dashboard</title>

<style>
  body {
    margin: 0;
    font-family: Inter, sans-serif;
    background: #f7f7f9;
    display: flex;
  }

  /* Sidebar */
  .sidebar {
    width: 240px;
    background: #0f766e;
    color: white;
    padding: 20px;
    height: 100vh;
  }
  .logo {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 40px;
  }
  .menu-item {
    margin-bottom: 18px;
    cursor: pointer;
  }
  .menu-item:hover {
    text-decoration: underline;
  }

  /* Main area */
  .main {
    flex: 1;
    padding: 32px;
  }

  /* Profile card */
  .profile-card {
    background: white;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    max-width: 460px;
  }
  .avatar {
    width: 64px;
    height: 64px;
    background: #d1fae5;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #065f46;
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 10px;
  }
  label {
    margin-top: 12px;
    display: block;
    font-size: 14px;
  }
  input {
    width: 100%;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    margin-top: 6px;
  }
  .save-btn {
    margin-top: 18px;
    padding: 12px;
    border: none;
    background: #0f766e;
    color: white;
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    width: 100%;
  }
  .status {
    margin-top: 10px;
    font-size: 13px;
  }
</style>
</head>

<body>

<div class="sidebar">
  <div class="logo">Solvoro</div>

  <div class="menu-item">Profile</div>
  <div class="menu-item">My Orders</div>
  <div class="menu-item" id="logoutBtn">Logout</div>
</div>

<div class="main">
  <h2>Your Profile</h2>

  <div class="profile-card">
    <div id="avatar" class="avatar">?</div>

    <label>Full Name</label>
    <input id="fullName" type="text" />

    <label>Aadhaar Number</label>
    <input id="aadhaar" type="text" maxlength="12" placeholder="12 digit Aadhaar" />

    <label>Phone</label>
    <input id="phone" type="text" />

    <label>Address</label>
    <input id="address" type="text" />

    <label>City</label>
    <input id="city" type="text" />

    <label>Discount Eligible?</label>
    <input id="discount" type="text" disabled />

    <button class="save-btn" id="saveBtn">Save Profile</button>

    <div id="saveStatus" class="status"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getAuth,
  onAuthStateChanged,
  signOut
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import {
  getFirestore,
  doc,
  getDoc,
  setDoc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBbWQgBjAIAn-OI3DzDAqx7lmLmbUCUAWU",
  authDomain: "solvoro-c9155.firebaseapp.com",
  projectId: "solvoro-c9155",
  storageBucket: "solvoro-c9155.firebasestorage.app",
  messagingSenderId: "536457030363",
  appId: "1:536457030363:web:e3315527c15fc037ba3afe"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const avatar = document.getElementById("avatar");
const fullName = document.getElementById("fullName");
const aadhaar = document.getElementById("aadhaar");
const phone = document.getElementById("phone");
const address = document.getElementById("address");
const city = document.getElementById("city");
const discount = document.getElementById("discount");
const saveBtn = document.getElementById("saveBtn");
const saveStatus = document.getElementById("saveStatus");

// Ensure user logged in
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "./";
    return;
  }

  const uid = user.uid;
  const ref = doc(db, "users", uid);
  const snap = await getDoc(ref);

  if (snap.exists()) {
    const data = snap.data();

    fullName.value = data.fullName || "";
    aadhaar.value = data.aadhaar || "";
    phone.value = data.phone || "";
    address.value = data.address || "";
    city.value = data.city || "";
    discount.value = data.discountEligible ? "Yes (Admin Approved)" : "No";
  }

  updateAvatar();
});

// Update avatar when name changes
fullName.addEventListener("input", updateAvatar);

function updateAvatar() {
  const name = fullName.value.trim();
  avatar.textContent = name ? name.charAt(0).toUpperCase() : "?";
}

// Save profile
saveBtn.addEventListener("click", async () => {
  const user = auth.currentUser;
  if (!user) return;

  await setDoc(doc(db, "users", user.uid), {
    fullName: fullName.value,
    aadhaar: aadhaar.value,
    phone: phone.value,
    address: address.value,
    city: city.value,
  }, { merge: true });

  saveStatus.textContent = "Profile saved!";
});

// Logout
document.getElementById("logoutBtn").onclick = () => signOut(auth);
</script>

</body>
</html>
