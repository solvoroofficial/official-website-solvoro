<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solvoro ‚Äî Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: Inter, system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top left, #eef2ff, #f9fafb 50%);
      color: #111827;
      min-height: 100vh;
      display: flex;
    }
    .app-shell {
      display: flex;
      width: 100%;
      min-height: 100vh;
    }
    /* Sidebar */
    .sidebar {
      width: 240px;
      background: #ffffffcc;
      backdrop-filter: blur(14px);
      border-right: 1px solid #e5e7eb;
      padding: 18px 16px;
      display: flex;
      flex-direction: column;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 24px;
    }
    .brand-avatar {
      width: 36px;
      height: 36px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #a5b4fc, #22c1c3);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 18px;
    }
    .brand-text-title {
      font-weight: 600;
      font-size: 16px;
    }
    .brand-text-sub {
      font-size: 12px;
      color: #6b7280;
    }
    .nav {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .nav-button {
      border: none;
      background: transparent;
      text-align: left;
      padding: 9px 10px;
      border-radius: 10px;
      font-size: 14px;
      color: #4b5563;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .nav-button span.icon {
      font-size: 16px;
    }
    .nav-button.active {
      background: linear-gradient(135deg, #eef2ff, #e0f2fe);
      color: #111827;
      font-weight: 500;
    }
    .sidebar-footer {
      margin-top: auto;
      font-size: 11px;
      color: #9ca3af;
    }

    /* Main */
    .main {
      flex: 1;
      padding: 18px 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .topbar-title {
      font-size: 18px;
      font-weight: 600;
    }
    .topbar-subtitle {
      font-size: 13px;
      color: #6b7280;
    }

    .topbar-user {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .user-avatar {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: #0f766e;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 14px;
    }
    .user-email {
      font-size: 13px;
      color: #4b5563;
    }
    .btn-ghost {
      padding: 6px 10px;
      font-size: 13px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: white;
      cursor: pointer;
    }

    /* Content / pages */
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      padding: 18px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
    }
    .card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
    }
    .card-subtitle {
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 10px;
    }

    .page {
      display: none;
    }
    .page.active {
      display: block;
    }

    /* Home page */
    .home-grid {
      display: grid;
      grid-template-columns: minmax(0,2fr) minmax(0,1.4fr);
      gap: 12px;
    }
    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
      margin-bottom: 8px;
    }

    /* Services placeholder */
    .tag {
      display: inline-flex;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: #f3f4f6;
      color: #4b5563;
      margin-right: 4px;
      margin-bottom: 4px;
    }

    /* Profile page */
    .profile-wrap {
      display: grid;
      grid-template-columns: minmax(0,2fr) minmax(0,1.4fr);
      gap: 14px;
    }
    .form-group {
      margin-top: 10px;
    }
    .form-label {
      font-size: 13px;
      color: #4b5563;
      margin-bottom: 4px;
      display: block;
    }
    .form-input {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      font-size: 14px;
    }
    .btn-primary {
      margin-top: 12px;
      padding: 9px 14px;
      font-size: 14px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #0f766e, #22c55e);
      color: white;
      font-weight: 500;
      cursor: pointer;
    }
    .btn-outline {
      margin-top: 8px;
      padding: 8px 12px;
      font-size: 13px;
      border-radius: 999px;
      border: 1px solid #0f766e;
      background: white;
      color: #0f766e;
      cursor: pointer;
    }
    .helper {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
    }
    .status-label {
      font-size: 12px;
      margin-top: 8px;
    }
    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11px;
    }
    .status-pending {
      background: #fef3c7;
      color: #92400e;
    }
    .status-approved {
      background: #dcfce7;
      color: #166534;
    }
    .status-rejected {
      background: #fee2e2;
      color: #991b1b;
    }
    .status-none {
      background: #f3f4f6;
      color: #4b5563;
    }
    .small-text {
      font-size: 12px;
      color: #6b7280;
      margin-top: 6px;
    }
    .success-msg {
      font-size: 12px;
      color: #15803d;
      margin-top: 8px;
    }
    .error-msg {
      font-size: 12px;
      color: #b91c1c;
      margin-top: 8px;
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }
      .main {
        padding: 14px 12px;
      }
      .home-grid, .profile-wrap {
        grid-template-columns: minmax(0,1fr);
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-avatar">S</div>
        <div>
          <div class="brand-text-title">Solvoro</div>
          <div class="brand-text-sub">Client Dashboard</div>
        </div>
      </div>
      <nav class="nav">
        <!-- data-page points to the page id -->
        <button class="nav-button active" data-page="page-home">
          <span class="icon">üè†</span> Home
        </button>
        <button class="nav-button" data-page="page-services">
          <span class="icon">üß©</span> Services
        </button>
        <button class="nav-button" data-page="page-profile">
          <span class="icon">üë§</span> Profile
        </button>
      </nav>
      <div class="sidebar-footer">
        Admin panel is separate and hidden from client area.
      </div>
    </aside>

    <!-- Main area -->
    <div class="main">
      <!-- Top bar -->
      <header class="topbar">
        <div>
          <div class="topbar-title" id="pageTitle">Home</div>
          <div class="topbar-subtitle">Your personal Solvoro space</div>
        </div>
        <div class="topbar-user">
          <div class="user-avatar" id="userAvatar">?</div>
          <div class="user-email" id="userEmail">...</div>
          <button class="btn-ghost" id="signOutBtn">Sign out</button>
        </div>
      </header>

      <!-- Content -->
      <div class="content">

        <!-- HOME PAGE -->
        <section class="page active" id="page-home">
          <div class="card">
            <div class="pill">Signed in ‚Ä¢ Solvoro client</div>
            <div class="card-title">Welcome back üëã</div>
            <div class="card-subtitle">
              From here you‚Äôll see your basic info, services and special children discount status.
            </div>
            <p class="small-text">
              You will place orders from the main Solvoro website or services page. This dashboard is only
              for viewing and managing your details and discount request.
            </p>
          </div>

          <div class="home-grid">
            <div class="card">
              <div class="card-title">Quick glance</div>
              <p class="small-text">
                ‚Ä¢ Profile details are saved in our secure database. <br>
                ‚Ä¢ Children under 24 years can request a 40% discount (handled by admin). <br>
                ‚Ä¢ Admin panel is separate and not visible from here.
              </p>
            </div>
            <div class="card">
              <div class="card-title">Next steps</div>
              <p class="small-text">
                1. Go to <b>Profile</b> and fill your name and (optionally) Aadhaar number. <br>
                2. If you‚Äôre eligible as a child (under 24), submit a <b>40% off request</b>. <br>
                3. Admin will review and approve or reject the request.
              </p>
            </div>
          </div>
        </section>

        <!-- SERVICES PAGE (placeholder for now) -->
        <section class="page" id="page-services">
          <div class="card">
            <div class="card-title">Services overview</div>
            <div class="card-subtitle">
              This is just a placeholder. Your real services will come from the public Solvoro website or admin.
            </div>
            <p class="small-text">
              Later from admin page, you will add services like:
            </p>
            <div>
              <span class="tag">Website Design</span>
              <span class="tag">Logo Design</span>
              <span class="tag">Social Media Poster</span>
              <span class="tag">Business Card</span>
              <span class="tag">Promo Video</span>
            </div>
            <p class="small-text" style="margin-top:10px;">
              Client will see details in a popup on the service page and then place order from there.
              This dashboard will only show basic info and discount status.
            </p>
          </div>
        </section>

        <!-- PROFILE PAGE (Aadhaar + 40% off request) -->
        <section class="page" id="page-profile">
          <div class="profile-wrap">
            <div class="card">
              <div class="card-title">Your profile</div>
              <div class="card-subtitle">
                Basic details stored for your orders and children discount.
              </div>

              <div class="form-group">
                <label class="form-label">Full name</label>
                <input id="fullNameInput" class="form-input" type="text" placeholder="Your full name" />
              </div>

              <div class="form-group">
                <label class="form-label">Aadhaar number (optional for children)</label>
                <input id="aadhaarInput" class="form-input" type="text" placeholder="xxxx-xxxx-xxxx" />
                <div class="helper">
                  Only needed if you want to request the 40% children discount (under 24 years).
                </div>
              </div>

              <button class="btn-primary" id="saveProfileBtn">Save details</button>
              <div id="profileSaveMsg" class="success-msg" style="display:none;"></div>
              <div id="profileErrorMsg" class="error-msg" style="display:none;"></div>
            </div>

            <div class="card">
              <div class="card-title">40% Children Discount</div>
              <div class="card-subtitle">
                Request discount for children under 24. Final decision is taken by admin from a separate admin panel.
              </div>

              <p class="small-text">
                ‚Ä¢ First, fill your Aadhaar number above and save. <br>
                ‚Ä¢ After Aadhaar is saved, you can send one request for 40% off. <br>
                ‚Ä¢ Admin will check your age / eligibility and update the status.
              </p>

              <button class="btn-outline" id="requestDiscountBtn" style="display:none;">
                Request 40% off for children
              </button>

              <div class="status-label">Current status:</div>
              <div id="discountStatusPill" class="status-pill status-none">
                <span>‚Ä¢</span><span id="discountStatusText">No request yet</span>
              </div>

              <div class="small-text" id="discountInfoText">
                No discount request submitted yet.
              </div>
            </div>
          </div>
        </section>

      </div>
    </div>
  </div>

  <!-- Firebase + Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // --- Your Firebase config (same as login page) ---
    const firebaseConfig = {
      apiKey: "AIzaSyBbWQgBjAIAn-OI3DzDAqx7lmLmbUCUAWU",
      authDomain: "solvoro-c9155.firebaseapp.com",
      projectId: "solvoro-c9155",
      storageBucket: "solvoro-c9155.firebasestorage.app",
      messagingSenderId: "536457030363",
      appId: "1:536457030363:web:e3315527c15fc037ba3afe",
      measurementId: "G-Z47VFQ3C7Q"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- DOM elements ---
    const userAvatarEl = document.getElementById("userAvatar");
    const userEmailEl = document.getElementById("userEmail");
    const signOutBtn = document.getElementById("signOutBtn");

    const navButtons = document.querySelectorAll(".nav-button");
    const pages = document.querySelectorAll(".page");
    const pageTitleEl = document.getElementById("pageTitle");

    // Profile elements
    const fullNameInput = document.getElementById("fullNameInput");
    const aadhaarInput = document.getElementById("aadhaarInput");
    const saveProfileBtn = document.getElementById("saveProfileBtn");
    const profileSaveMsg = document.getElementById("profileSaveMsg");
    const profileErrorMsg = document.getElementById("profileErrorMsg");

    // Discount elements
    const requestDiscountBtn = document.getElementById("requestDiscountBtn");
    const discountStatusPill = document.getElementById("discountStatusPill");
    const discountStatusText = document.getElementById("discountStatusText");
    const discountInfoText = document.getElementById("discountInfoText");

    let currentUser = null;
    let loadingProfile = false;

    // --- Helpers ---
    function setAvatarFromUser(user) {
      const email = user?.email || "";
      const letter = email ? email.charAt(0).toUpperCase() : "?";
      userAvatarEl.textContent = letter;
      userEmailEl.textContent = email || "";
    }

    function setActivePage(pageId) {
      pages.forEach(p => {
        if (p.id === pageId) p.classList.add("active");
        else p.classList.remove("active");
      });
      navButtons.forEach(btn => {
        if (btn.dataset.page === pageId) btn.classList.add("active");
        else btn.classList.remove("active");
      });
      if (pageId === "page-home") pageTitleEl.textContent = "Home";
      if (pageId === "page-services") pageTitleEl.textContent = "Services";
      if (pageId === "page-profile") pageTitleEl.textContent = "Profile";
    }

    function updateDiscountUI(status) {
      // status: "none" | "pending" | "approved" | "rejected"
      discountStatusPill.className = "status-pill";
      if (status === "pending") {
        discountStatusPill.classList.add("status-pending");
        discountStatusText.textContent = "Pending ‚Äî waiting for admin review";
        discountInfoText.textContent = "Your 40% off request is sent. Admin will check eligibility and update.";
      } else if (status === "approved") {
        discountStatusPill.classList.add("status-approved");
        discountStatusText.textContent = "Approved ‚Äî 40% discount applicable";
        discountInfoText.textContent = "Admin has approved your children discount. It will apply when placing orders.";
      } else if (status === "rejected") {
        discountStatusPill.classList.add("status-rejected");
        discountStatusText.textContent = "Rejected ‚Äî not eligible";
        discountInfoText.textContent = "Admin has rejected the request. If you think this is wrong, contact support.";
      } else {
        discountStatusPill.classList.add("status-none");
        discountStatusText.textContent = "No request yet";
        discountInfoText.textContent = "No discount request submitted yet.";
      }
    }

    function showRequestButtonIfAadhaarPresent() {
      const value = aadhaarInput.value.trim();
      if (value) {
        requestDiscountBtn.style.display = "inline-flex";
      } else {
        requestDiscountBtn.style.display = "none";
      }
    }

    // --- Load / Save profile ---
    async function loadProfile(user) {
      if (!user) return;
      loadingProfile = true;
      profileSaveMsg.style.display = "none";
      profileErrorMsg.style.display = "none";
      try {
        const ref = doc(db, "users", user.uid);
        const snap = await getDoc(ref);
        if (snap.exists()) {
          const data = snap.data();
          if (data.fullName) fullNameInput.value = data.fullName;
          if (data.aadhaarNumber) aadhaarInput.value = data.aadhaarNumber;
          const status = data.discountRequestStatus || "none";
          updateDiscountUI(status);
          showRequestButtonIfAadhaarPresent();
        } else {
          // no doc yet
          updateDiscountUI("none");
          showRequestButtonIfAadhaarPresent();
        }
      } catch (err) {
        console.error("Error loading profile", err);
        profileErrorMsg.textContent = "Failed to load profile.";
        profileErrorMsg.style.display = "block";
      } finally {
        loadingProfile = false;
      }
    }

    async function saveProfile() {
      if (!currentUser) return;
      profileSaveMsg.style.display = "none";
      profileErrorMsg.style.display = "none";
      const fullName = fullNameInput.value.trim();
      const aadhaar = aadhaarInput.value.trim();

      try {
        const ref = doc(db, "users", currentUser.uid);
        await setDoc(ref, {
          fullName: fullName || null,
          aadhaarNumber: aadhaar || null
        }, { merge: true });

        profileSaveMsg.textContent = "Profile saved successfully.";
        profileSaveMsg.style.display = "block";
        showRequestButtonIfAadhaarPresent();
      } catch (err) {
        console.error(err);
        profileErrorMsg.textContent = "Failed to save profile. Please try again.";
        profileErrorMsg.style.display = "block";
      }
    }

    async function requestDiscount() {
      if (!currentUser) return;
      profileSaveMsg.style.display = "none";
      profileErrorMsg.style.display = "none";

      const aadhaar = aadhaarInput.value.trim();
      if (!aadhaar) {
        profileErrorMsg.textContent = "Please add Aadhaar number first, then save profile.";
        profileErrorMsg.style.display = "block";
        return;
      }

      try {
        const ref = doc(db, "users", currentUser.uid);
        await setDoc(ref, {
          discountRequestStatus: "pending"
        }, { merge: true });

        updateDiscountUI("pending");
        profileSaveMsg.textContent = "Discount request sent. Admin will review.";
        profileSaveMsg.style.display = "block";
      } catch (err) {
        console.error(err);
        profileErrorMsg.textContent = "Failed to send discount request.";
        profileErrorMsg.style.display = "block";
      }
    }

    // --- Event listeners ---
    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const pageId = btn.dataset.page;
        setActivePage(pageId);
      });
    });

    saveProfileBtn.addEventListener("click", saveProfile);
    aadhaarInput.addEventListener("input", showRequestButtonIfAadhaarPresent);
    requestDiscountBtn.addEventListener("click", requestDiscount);

    signOutBtn.addEventListener("click", async () => {
      await signOut(auth);
      // change to your actual login page filename if different
      window.location.href = "index.html";
    });

    // --- Auth state ---
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        // not logged in -> back to login
        // change this to your login file (the one you pasted earlier)
        window.location.href = "index.html";
        return;
      }
      currentUser = user;
      setAvatarFromUser(user);
      await loadProfile(user);
    });
  </script>
</body>
</html>
